/**
 * Copyright p5.recorder
 * v0.0.3
 * by doriclaudino <dori.claudino@gmail.com>
 * 4/27/2020
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).p5=e.p5||{},e.p5.Recorder=t())}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function e(t,i,n){var r,o,a=window,s="application/octet-stream",d=n||s,c=t,h=!i&&!n&&c,u=document.createElement("a"),l=function(e){return String(e)},p=a.Blob||a.MozBlob||a.WebKitBlob||l,f=i||"download";if(p=p.call?p.bind(a):Blob,"true"===String(this)&&(d=(c=[c,d])[0],c=c[1]),h&&h.length<2048&&(f=h.split("/").pop().split("?")[0],u.href=h,-1!==u.href.indexOf(h))){var g=new XMLHttpRequest;return g.open("GET",h,!0),g.responseType="blob",g.onload=function(t){e(t.target.response,f,s)},setTimeout((function(){g.send()}),0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&p!==l))return navigator.msSaveBlob?navigator.msSaveBlob(b(c),f):w(c);d=(c=b(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var m=0,v=new Uint8Array(c.length),_=v.length;m<_;++m)v[m]=c.charCodeAt(m);c=new p([v],{type:d})}function b(e){for(var t=e.split(/[:;,]/),i=t[1],n=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),r=n.length,o=0,a=new Uint8Array(r);o<r;++o)a[o]=n.charCodeAt(o);return new p([a],{type:i})}function w(e,t){if("download"in u)return u.href=e,u.setAttribute("download",f),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===t&&setTimeout((function(){a.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var i=document.createElement("iframe");document.body.appendChild(i),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),i.src=e,setTimeout((function(){document.body.removeChild(i)}),333)}if(r=c instanceof p?c:new p([c],{type:d}),navigator.msSaveBlob)return navigator.msSaveBlob(r,f);if(a.URL)w(a.URL.createObjectURL(r),!0);else{if("string"==typeof r||r.constructor===l)try{return w("data:"+d+";base64,"+a.btoa(r))}catch(e){return w("data:"+d+","+encodeURIComponent(r))}(o=new FileReader).onload=function(e){w(this.result)},o.readAsDataURL(r)}return!0}}));function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}return class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"p5.recorder.canvas.webm",i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t(this,"_isRecording",void 0),t(this,"_targetFps",void 0),t(this,"_endTime",void 0),t(this,"_outputName",void 0),t(this,"_chunks",void 0),t(this,"_recorder",void 0),t(this,"_saveAfterStop",void 0),t(this,"_canvas",void 0),this._isRecording=!1,this._targetFps=60,this._outputName=e,this._chunks=[],this._saveAfterStop=i}get currentBlob(){return new Blob(this._chunks)}start(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.querySelector("canvas"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._outputName;if(this._isRecording)throw new Error("Stop first before start again");if(this._canvas=e,this._outputName=t,!this._canvas)throw new Error("Can't find the canvas for start recording");if(!this._canvas.captureStream)throw new Error("Canvas can't support capture Stream");var i=this._canvas.captureStream(this._targetFps);this._recorder=new MediaRecorder(i),this._recorder.ondataavailable=this._onDataAvailable.bind(this),this._recorder.onstop=this._onMediaRecorderStop.bind(this),this._recorder.onstart=this._onMediaRecorderStart.bind(this),this._recorder.start()}_onDataAvailable(e){e.data.size&&this._chunks.push(e.data)}_onMediaRecorderStart(){this._isRecording=!0,this._initialRecordingTime=new Date,this._endRecordingTime=void 0,this._progress=0,this._chunks=[],this._chunks.length=0}_onMediaRecorderStop(){this._isRecording=!1,this._endRecordingTime=new Date,this._progress=100,this._saveAfterStop&&this.download()}download(){e(this.currentBlob,this._outputName,"video/webm")}stop(){this._recorder.stop()}get totalRecordedTime(){return this._endRecordingTime&&this._endRecordingTime.getTime()-this._initialRecordingTime.getTime()}get currentRecordingTime(){return(new Date).getTime()-this._initialRecordingTime.getTime()}get currentRecordingFrames(){return this.currentRecordingTime*this._targetFps}get totalRecordedFrames(){return this.totalRecordedTime*this._targetFps/1e3}}}));
//# sourceMappingURL=p5.recorder.min.js.map
