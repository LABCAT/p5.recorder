/**
 * Copyright p5.recorder
 * v0.0.5
 * by doriclaudino <dori.claudino@gmail.com>
 * 5/2/2020
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):((t=t||self).p5=t.p5||{},t.p5.Recorder=e())}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function t(e,n,i){var a,o,r=window,s="application/octet-stream",d=i||s,h=e,l=!n&&!i&&h,u=document.createElement("a"),c=function(t){return String(t)},f=r.Blob||r.MozBlob||r.WebKitBlob||c,p=n||"download";if(f=f.call?f.bind(r):Blob,"true"===String(this)&&(d=(h=[h,d])[0],h=h[1]),l&&l.length<2048&&(p=l.split("/").pop().split("?")[0],u.href=l,-1!==u.href.indexOf(l))){var w=new XMLHttpRequest;return w.open("GET",l,!0),w.responseType="blob",w.onload=function(e){t(e.target.response,p,s)},setTimeout((function(){w.send()}),0),w}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(h)){if(!(h.length>2096103.424&&f!==c))return navigator.msSaveBlob?navigator.msSaveBlob(m(h),p):y(h);d=(h=m(h)).type||s}else if(/([\x80-\xff])/.test(h)){for(var v=0,b=new Uint8Array(h.length),g=b.length;v<g;++v)b[v]=h.charCodeAt(v);h=new f([b],{type:d})}function m(t){for(var e=t.split(/[:;,]/),n=e[1],i=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),a=i.length,o=0,r=new Uint8Array(a);o<a;++o)r[o]=i.charCodeAt(o);return new f([r],{type:n})}function y(t,e){if("download"in u)return u.href=t,u.setAttribute("download",p),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===e&&setTimeout((function(){r.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,s)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,s)),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)}if(a=h instanceof f?h:new f([h],{type:d}),navigator.msSaveBlob)return navigator.msSaveBlob(a,p);if(r.URL)y(r.URL.createObjectURL(a),!0);else{if("string"==typeof a||a.constructor===c)try{return y("data:"+d+";base64,"+r.btoa(a))}catch(t){return y("data:"+d+","+encodeURIComponent(a))}(o=new FileReader).onload=function(t){y(this.result)},o.readAsDataURL(a)}return!0}}));function e(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}function n(t,e,n){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,n);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=n}return n}function i(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}var a=new WeakMap,o=new WeakMap,r=new WeakMap,s=new WeakMap,d=new WeakMap,h=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,p=new WeakMap,w=new WeakSet,v=new WeakSet,b=new WeakSet,g=new WeakMap,m=new WeakMap,y=function(){return new Blob(e(this,r))},k=function(){return e(this,s)&&"recording"===e(this,s).state},M=function(){return e(this,s)&&"paused"===e(this,s).state},W=function(t){t.data.size&&e(this,r).push(t.data)},S=function(){n(this,u,{start:new Date,end:void 0}),n(this,l,0),n(this,r,[]),e(this,r).length=0},T=function(){e(this,u).end=new Date,n(this,l,100),e(this,d)&&this.download()},R=function(){return(e(this,u).end?e(this,u).end.getTime():(new Date).getTime())-e(this,u).start.getTime()},U=function(){return e(this,g)*e(this,a)/1e3};return class{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"p5.recorder.canvas.webm",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];m.set(this,{get:U,set:void 0}),g.set(this,{get:R,set:void 0}),b.add(this),v.add(this),w.add(this),p.set(this,{get:M,set:void 0}),f.set(this,{get:k,set:void 0}),c.set(this,{get:y,set:void 0}),a.set(this,{writable:!0,value:void 0}),o.set(this,{writable:!0,value:void 0}),r.set(this,{writable:!0,value:void 0}),s.set(this,{writable:!0,value:void 0}),d.set(this,{writable:!0,value:void 0}),h.set(this,{writable:!0,value:void 0}),l.set(this,{writable:!0,value:void 0}),u.set(this,{writable:!0,value:void 0}),n(this,a,60),n(this,o,t),n(this,r,[]),n(this,d,e),n(this,u,{})}start(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.querySelector("canvas"),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e(this,o);if(e(this,f)||e(this,p))throw new Error("Stop first before start again");if(n(this,h,t),n(this,o,r),!e(this,h))throw new Error("Can't find the canvas for start recording");if(!e(this,h).captureStream)throw new Error("Canvas can't support capture Stream");var d=e(this,h).captureStream(e(this,a));n(this,s,new MediaRecorder(d)),e(this,s).ondataavailable=i(this,w,W).bind(this),e(this,s).onstop=i(this,b,T).bind(this),e(this,s).onstart=i(this,v,S).bind(this),e(this,s).start()}download(){t(e(this,c),e(this,o),"video/webm")}stop(){e(this,s).stop()}get status(){return{state:e(this,s).state,time:e(this,g),frames:e(this,m),progress:e(this,l)}}}}));
//# sourceMappingURL=p5.recorder.min.js.map
