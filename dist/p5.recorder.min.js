!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).p5=e.p5||{},e.p5.Recorder=t())}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function e(t,n,r){var i,o,a=window,s="application/octet-stream",d=r||s,c=t,h=!n&&!r&&c,u=document.createElement("a"),l=function(e){return String(e)},p=a.Blob||a.MozBlob||a.WebKitBlob||l,f=n||"download";if(p=p.call?p.bind(a):Blob,"true"===String(this)&&(d=(c=[c,d])[0],c=c[1]),h&&h.length<2048&&(f=h.split("/").pop().split("?")[0],u.href=h,-1!==u.href.indexOf(h))){var g=new XMLHttpRequest;return g.open("GET",h,!0),g.responseType="blob",g.onload=function(t){e(t.target.response,f,s)},setTimeout((function(){g.send()}),0),g}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&p!==l))return navigator.msSaveBlob?navigator.msSaveBlob(w(c),f):b(c);d=(c=w(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var m=0,_=new Uint8Array(c.length),v=_.length;m<v;++m)_[m]=c.charCodeAt(m);c=new p([_],{type:d})}function w(e){for(var t=e.split(/[:;,]/),n=t[1],r=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),i=r.length,o=0,a=new Uint8Array(i);o<i;++o)a[o]=r.charCodeAt(o);return new p([a],{type:n})}function b(e,t){if("download"in u)return u.href=e,u.setAttribute("download",f),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===t&&setTimeout((function(){a.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),n.src=e,setTimeout((function(){document.body.removeChild(n)}),333)}if(i=c instanceof p?c:new p([c],{type:d}),navigator.msSaveBlob)return navigator.msSaveBlob(i,f);if(a.URL)b(a.URL.createObjectURL(i),!0);else{if("string"==typeof i||i.constructor===l)try{return b("data:"+d+";base64,"+a.btoa(i))}catch(e){return b("data:"+d+","+encodeURIComponent(i))}(o=new FileReader).onload=function(e){b(this.result)},o.readAsDataURL(i)}return!0}}));return class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"p5.recorder.canvas.webm",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._isRecording=!1,this._targetFps=60,this._initialTime,this._endTime,this._outputName=e,this._chunks=[],this._recorder,this._saveAtEnd=t,this._canvas}get currentBlob(){return new Blob(this._chunks)}start(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.querySelector("canvas"),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._outputName;if(this._isRecording)throw new Error("Stop first before start again");if(this._canvas=e,this._outputName=t,!this._canvas||!this._canvas.captureStream)throw new Error("Can't find the canvas for start recording");var n=this._canvas.captureStream(this._targetFps);this._recorder=new MediaRecorder(n),this._recorder.ondataavailable=e=>{e.data.size&&this._chunks.push(e.data)},this._recorder.onstop=this._onMediaRecorderStop.bind(this),this._recorder.onstart=this._onMediaRecorderStart.bind(this),this._recorder.start()}_onMediaRecorderStart(){this._isRecording=!0,this._initialRecordingTime=new Date,this._endRecordingTime=void 0,this._progress=0,this._chunks=[],this._chunks.length=0}_onMediaRecorderStop(){this._isRecording=!1,this._endRecordingTime=new Date,this._progress=100,this._saveAtEnd&&this.download()}download(){e(this.currentBlob,this._outputName,"video/webm")}stop(){this._recorder.stop()}get totalRecordedTime(){return this._endRecordingTime-this._initialRecordingTime}get currentRecordingTime(){return new Date-this._initialRecordingTime}get currentRecordingFrames(){return this.currentRecordingTime*this.targetFps}get targetFps(){return this._targetFps}get totalRecordedFrames(){return this.totalRecordedTime*this.targetFps/1e3}}}));
//# sourceMappingURL=p5.recorder.min.js.map
