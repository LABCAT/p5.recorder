{"version":3,"file":"p5.recorder.js","sources":["../node_modules/downloadjs/download.js","../src/p5.recorder.js"],"sourcesContent":["//download.js v4.2, by dandavis; 2008-2016. [MIT] see http://danml.com/download.html for tests/usage\n// v1 landed a FF+Chrome compat way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime\n// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs\n// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support. 3.1 improved safari handling.\n// v4 adds AMD/UMD, commonJS, and plain browser support\n// v4.1 adds url download capability via solo URL argument (same domain/CORS only)\n// v4.2 adds semantic variable names, long (over 2MB) dataURL support, and hidden by default temp anchors\n// https://github.com/rndme/download\n\n(function (root, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine([], factory);\n\t} else if (typeof exports === 'object') {\n\t\t// Node. Does not work with strict CommonJS, but\n\t\t// only CommonJS-like environments that support module.exports,\n\t\t// like Node.\n\t\tmodule.exports = factory();\n\t} else {\n\t\t// Browser globals (root is window)\n\t\troot.download = factory();\n  }\n}(this, function () {\n\n\treturn function download(data, strFileName, strMimeType) {\n\n\t\tvar self = window, // this script is only for browsers anyway...\n\t\t\tdefaultMime = \"application/octet-stream\", // this default mime also triggers iframe downloads\n\t\t\tmimeType = strMimeType || defaultMime,\n\t\t\tpayload = data,\n\t\t\turl = !strFileName && !strMimeType && payload,\n\t\t\tanchor = document.createElement(\"a\"),\n\t\t\ttoString = function(a){return String(a);},\n\t\t\tmyBlob = (self.Blob || self.MozBlob || self.WebKitBlob || toString),\n\t\t\tfileName = strFileName || \"download\",\n\t\t\tblob,\n\t\t\treader;\n\t\t\tmyBlob= myBlob.call ? myBlob.bind(self) : Blob ;\n\t  \n\t\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\n\t\t\tpayload=[payload, mimeType];\n\t\t\tmimeType=payload[0];\n\t\t\tpayload=payload[1];\n\t\t}\n\n\n\t\tif(url && url.length< 2048){ // if no filename and no mime, assume a url was passed as the only argument\n\t\t\tfileName = url.split(\"/\").pop().split(\"?\")[0];\n\t\t\tanchor.href = url; // assign href prop to temp anchor\n\t\t  \tif(anchor.href.indexOf(url) !== -1){ // if the browser determines that it's a potentially valid url path:\n        \t\tvar ajax=new XMLHttpRequest();\n        \t\tajax.open( \"GET\", url, true);\n        \t\tajax.responseType = 'blob';\n        \t\tajax.onload= function(e){ \n\t\t\t\t  download(e.target.response, fileName, defaultMime);\n\t\t\t\t};\n        \t\tsetTimeout(function(){ ajax.send();}, 0); // allows setting custom ajax headers using the return:\n\t\t\t    return ajax;\n\t\t\t} // end if valid url?\n\t\t} // end if url?\n\n\n\t\t//go ahead and download dataURLs right away\n\t\tif(/^data:([\\w+-]+\\/[\\w+.-]+)?[,;]/.test(payload)){\n\t\t\n\t\t\tif(payload.length > (1024*1024*1.999) && myBlob !== toString ){\n\t\t\t\tpayload=dataUrlToBlob(payload);\n\t\t\t\tmimeType=payload.type || defaultMime;\n\t\t\t}else{\t\t\t\n\t\t\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\n\t\t\t\t\tnavigator.msSaveBlob(dataUrlToBlob(payload), fileName) :\n\t\t\t\t\tsaver(payload) ; // everyone else can save dataURLs un-processed\n\t\t\t}\n\t\t\t\n\t\t}else{//not data url, is it a string with special needs?\n\t\t\tif(/([\\x80-\\xff])/.test(payload)){\t\t\t  \n\t\t\t\tvar i=0, tempUiArr= new Uint8Array(payload.length), mx=tempUiArr.length;\n\t\t\t\tfor(i;i<mx;++i) tempUiArr[i]= payload.charCodeAt(i);\n\t\t\t \tpayload=new myBlob([tempUiArr], {type: mimeType});\n\t\t\t}\t\t  \n\t\t}\n\t\tblob = payload instanceof myBlob ?\n\t\t\tpayload :\n\t\t\tnew myBlob([payload], {type: mimeType}) ;\n\n\n\t\tfunction dataUrlToBlob(strUrl) {\n\t\t\tvar parts= strUrl.split(/[:;,]/),\n\t\t\ttype= parts[1],\n\t\t\tdecoder= parts[2] == \"base64\" ? atob : decodeURIComponent,\n\t\t\tbinData= decoder( parts.pop() ),\n\t\t\tmx= binData.length,\n\t\t\ti= 0,\n\t\t\tuiArr= new Uint8Array(mx);\n\n\t\t\tfor(i;i<mx;++i) uiArr[i]= binData.charCodeAt(i);\n\n\t\t\treturn new myBlob([uiArr], {type: type});\n\t\t }\n\n\t\tfunction saver(url, winMode){\n\n\t\t\tif ('download' in anchor) { //html5 A[download]\n\t\t\t\tanchor.href = url;\n\t\t\t\tanchor.setAttribute(\"download\", fileName);\n\t\t\t\tanchor.className = \"download-js-link\";\n\t\t\t\tanchor.innerHTML = \"downloading...\";\n\t\t\t\tanchor.style.display = \"none\";\n\t\t\t\tdocument.body.appendChild(anchor);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tanchor.click();\n\t\t\t\t\tdocument.body.removeChild(anchor);\n\t\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(anchor.href);}, 250 );}\n\t\t\t\t}, 66);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// handle non-a[download] safari as best we can:\n\t\t\tif(/(Version)\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari\\//.test(navigator.userAgent)) {\n\t\t\t\tif(/^data:/.test(url))\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t\tif(!window.open(url)){ // popup blocked, offer direct download:\n\t\t\t\t\tif(confirm(\"Displaying New Document\\n\\nUse Save As... to download, then click back to return to this page.\")){ location.href=url; }\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//do iframe dataURL download (old ch+FF):\n\t\t\tvar f = document.createElement(\"iframe\");\n\t\t\tdocument.body.appendChild(f);\n\n\t\t\tif(!winMode && /^data:/.test(url)){ // force a mime that will download:\n\t\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t}\n\t\t\tf.src=url;\n\t\t\tsetTimeout(function(){ document.body.removeChild(f); }, 333);\n\n\t\t}//end saver\n\n\n\n\n\t\tif (navigator.msSaveBlob) { // IE10+ : (has Blob, but not a[download] or URL)\n\t\t\treturn navigator.msSaveBlob(blob, fileName);\n\t\t}\n\n\t\tif(self.URL){ // simple fast and modern way using Blob and URL:\n\t\t\tsaver(self.URL.createObjectURL(blob), true);\n\t\t}else{\n\t\t\t// handle non-Blob()+non-URL browsers:\n\t\t\tif(typeof blob === \"string\" || blob.constructor===toString ){\n\t\t\t\ttry{\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \";base64,\"  +  self.btoa(blob)  );\n\t\t\t\t}catch(y){\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \",\" + encodeURIComponent(blob)  );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Blob but not URL support:\n\t\t\treader=new FileReader();\n\t\t\treader.onload=function(e){\n\t\t\t\tsaver(this.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(blob);\n\t\t}\n\t\treturn true;\n\t}; /* end download() */\n}));\n","const _download = require(\"downloadjs\");\r\n\r\nexport default class Recorder {\r\n  _isRecording;\r\n  _targetFps;\r\n  _endTime;\r\n  _outputName;\r\n  _chunks;\r\n  _recorder;\r\n  _saveAfterStop;\r\n  _canvas;\r\n  _audioBitRate;\r\n  _videoBitRate;\r\n  _recordAudio;\r\n  _defaultCanvasMimeType;\r\n  _defaultStartOption;\r\n\r\n  constructor(saveAfterStop = true) {\r\n    this._isRecording = false;\r\n    this._chunks = [];\r\n    this._saveAfterStop = saveAfterStop;\r\n    this._defaultCanvasMimeType = \"video/webm\";\r\n    this._defaultStartOption = {\r\n      outputName: \"p5.recorder.canvas.webm\",\r\n      recordAudio: true,\r\n      audioBitRate: 128000,\r\n      videoBitRate: 10000000 * 12,\r\n      fps: 60,\r\n    };\r\n  }\r\n\r\n  get currentBlob() {\r\n    return new Blob(this._chunks);\r\n  }\r\n\r\n  async start(options = this._defaultStartOption) {\r\n    if (this._isRecording) throw new Error(\"Stop first before start again\");\r\n\r\n    //merge options\r\n    let mergeOptions = {\r\n      canvasElement: document.querySelector(\"canvas\"),\r\n      ...this._defaultStartOption,\r\n      ...options,\r\n    };\r\n    this._canvas = mergeOptions.canvasElement;\r\n    this._outputName = mergeOptions.outputName;\r\n    this._recordAudio = mergeOptions.recordAudio;\r\n    this._audioBitRate = mergeOptions.audioBitRate;\r\n    this._videoBitRate = mergeOptions.videoBitRate;\r\n    this._targetFps = mergeOptions.fps;\r\n\r\n    if (!this._canvas) throw new Error(\"Can't find the canvas for start recording\");\r\n    if (!this._canvas.captureStream) throw new Error(\"Canvas can't support capture Stream\");\r\n\r\n    let streamToRecord = await this._resolveStream();\r\n    this._createRecorder(streamToRecord);\r\n    this._recorder.start();\r\n  }\r\n\r\n  get getMediaRecorderOptionsForCanvas() {\r\n    return (\r\n      {\r\n        audioBitsPerSecond: this._audioBitRate,\r\n        videoBitsPerSecond: this._videoBitRate,\r\n        mimeType: this._defaultCanvasMimeType,\r\n      } || {}\r\n    );\r\n  }\r\n\r\n  async _resolveStream() {\r\n    let tracks = [];\r\n\r\n    //video track from canvas stream\r\n    let videoStream = this._canvas.captureStream(this._targetFps);\r\n    tracks.push(videoStream.getVideoTracks()[0]);\r\n\r\n    /**\r\n     * tracking here https://github.com/processing/p5.js-sound/issues/457\r\n     * the possibility to not use navigator.mediaDevices.getDisplayMedia API\r\n     */\r\n    if (this._recordAudio) {\r\n      let tabStream = await navigator.mediaDevices.getDisplayMedia({ audio: true, video: true });\r\n      let audioTracks = tabStream.getAudioTracks();\r\n      audioTracks.forEach((track) => tracks.push(track));\r\n    }\r\n\r\n    //combine video and audiotracks\r\n    let combinedStream = new MediaStream(tracks);\r\n    return combinedStream;\r\n  }\r\n\r\n  _createRecorder(stream) {\r\n    this._recorder = new MediaRecorder(stream, this.getMediaRecorderOptionsForCanvas);\r\n    this._recorder.onstop = this._onMediaRecorderStop.bind(this);\r\n    this._recorder.onstart = this._onMediaRecorderStart.bind(this);\r\n    this._recorder.ondataavailable = this._onDataAvailable.bind(this);\r\n    this._recorder.onstop = this._onMediaRecorderStop.bind(this);\r\n    this._recorder.onerror = (e) => console.log(e);\r\n    return this._recorder;\r\n  }\r\n\r\n  _onDataAvailable(e) {\r\n    if (e.data.size) {\r\n      this._chunks.push(e.data);\r\n    }\r\n  }\r\n\r\n  _onMediaRecorderStart() {\r\n    this._isRecording = true;\r\n    this._initialRecordingTime = new Date();\r\n    this._endRecordingTime = undefined;\r\n    this._progress = 0;\r\n    this._chunks = [];\r\n    this._chunks.length = 0;\r\n  }\r\n\r\n  _onMediaRecorderStop() {\r\n    this._isRecording = false;\r\n    this._endRecordingTime = new Date();\r\n    this._progress = 100;\r\n\r\n    /**\r\n     * we need process the mp4 encode for types diff from webm\r\n     */\r\n    if (this._saveAfterStop) this.download();\r\n  }\r\n\r\n  download() {\r\n    _download(this.currentBlob, this._outputName, \"video/webm\");\r\n  }\r\n\r\n  stop() {\r\n    this._recorder.stop();\r\n  }\r\n\r\n  get totalRecordedTime() {\r\n    return (\r\n      this._endRecordingTime &&\r\n      this._endRecordingTime.getTime() - this._initialRecordingTime.getTime()\r\n    );\r\n  }\r\n\r\n  get currentRecordingTime() {\r\n    return new Date().getTime() - this._initialRecordingTime.getTime();\r\n  }\r\n\r\n  get currentRecordingFrames() {\r\n    return this.currentRecordingTime * this._targetFps;\r\n  }\r\n\r\n  get totalRecordedFrames() {\r\n    return (this.totalRecordedTime * this._targetFps) / 1000;\r\n  }\r\n}\r\n"],"names":["this","Recorder","constructor","saveAfterStop","_isRecording","_chunks","_saveAfterStop","_defaultCanvasMimeType","_defaultStartOption","outputName","recordAudio","audioBitRate","videoBitRate","fps","currentBlob","Blob","start","options","Error","mergeOptions","canvasElement","document","querySelector","_canvas","_outputName","_recordAudio","_audioBitRate","_videoBitRate","_targetFps","captureStream","streamToRecord","_resolveStream","_createRecorder","_recorder","getMediaRecorderOptionsForCanvas","audioBitsPerSecond","videoBitsPerSecond","mimeType","tracks","videoStream","push","getVideoTracks","tabStream","navigator","mediaDevices","getDisplayMedia","audio","video","audioTracks","getAudioTracks","forEach","track","combinedStream","MediaStream","stream","MediaRecorder","onstop","_onMediaRecorderStop","bind","onstart","_onMediaRecorderStart","ondataavailable","_onDataAvailable","onerror","e","console","log","data","size","_initialRecordingTime","Date","_endRecordingTime","undefined","_progress","length","download","_download","stop","totalRecordedTime","getTime","currentRecordingTime","currentRecordingFrames","totalRecordedFrames"],"mappings":"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"}